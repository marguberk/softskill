import sqlite3
import json
from datetime import datetime

def add_lessons_to_courses():
    conn = sqlite3.connect('app.db')
    cursor = conn.cursor()
    
    # Получаем существующие курсы
    cursor.execute("SELECT id, title, skill_type FROM courses")
    courses = cursor.fetchall()
    
    print(f"Найдено курсов: {len(courses)}")
    
    # Данные уроков для разных курсов
    lessons_data = {
        1: {  # Основы коммуникации
            "skill": "communication",
            "lessons": [
                {
                    "title": "Введение в эффективную коммуникацию",
                    "description": "Основы межличностного общения и принципы эффективной коммуникации",
                    "content_type": "video",
                    "duration": 15,
                    "video_url": "https://www.youtube.com/watch?v=HAnw168huqA",
                    "video_id": "HAnw168huqA",
                    "theory": """# Введение в эффективную коммуникацию

## Что такое коммуникация?
Коммуникация - это процесс обмена информацией между людьми. Эффективная коммуникация помогает:
- Понимать друг друга
- Решать конфликты
- Строить доверительные отношения
- Достигать общих целей

## Основные принципы
1. **Активное слушание** - умение слышать собеседника
2. **Ясность изложения** - четкое выражение мыслей
3. **Эмпатия** - понимание чувств других
4. **Обратная связь** - подтверждение понимания""",
                    "tasks": [
                        {
                            "title": "Практика активного слушания",
                            "description": "Найдите коллегу и проведите 10-минутный разговор, где вы будете только слушать и задавать уточняющие вопросы. Запишите, что нового вы узнали."
                        },
                        {
                            "title": "Анализ собственного стиля общения",
                            "description": "Проанализируйте свой стиль общения: какие слова-паразиты вы используете? Как часто перебиваете собеседника? Составьте план улучшений."
                        }
                    ]
                },
                {
                    "title": "Невербальная коммуникация",
                    "description": "Изучение языка тела, жестов и мимики в общении",
                    "content_type": "video",
                    "duration": 20,
                    "video_url": "https://www.youtube.com/watch?v=X-DxGoIVUWo",
                    "video_id": "X-DxGoIVUWo",
                    "theory": """# Невербальная коммуникация

## Язык тела говорит больше слов
До 55% информации мы передаем через невербальные сигналы:
- Жесты и поза
- Мимика и выражение лица
- Зрительный контакт
- Тон голоса и интонация

## Ключевые элементы
1. **Поза** - открытая vs закрытая
2. **Жесты** - подчеркивающие vs отвлекающие
3. **Мимика** - искренность эмоций
4. **Дистанция** - личное пространство

## Практические советы
- Поддерживайте зрительный контакт
- Избегайте скрещенных рук
- Улыбайтесь искренне
- Следите за тоном голоса""",
                    "tasks": [
                        {
                            "title": "Наблюдение за невербаликой",
                            "description": "В течение дня наблюдайте за невербальными сигналами коллег. Запишите 5 интересных наблюдений о том, как жесты и мимика влияют на восприятие сообщения."
                        },
                        {
                            "title": "Тренировка уверенной позы",
                            "description": "Практикуйте уверенную позу перед зеркалом 5 минут: прямая спина, открытые жесты, зрительный контакт. Опишите свои ощущения."
                        }
                    ]
                },
                {
                    "title": "Управление конфликтами",
                    "description": "Техники разрешения конфликтов и сложных переговоров",
                    "content_type": "video",
                    "duration": 25,
                    "video_url": "https://www.youtube.com/watch?v=VR-YD3hOg4I",
                    "video_id": "VR-YD3hOg4I",
                    "theory": """# Управление конфликтами

## Природа конфликтов
Конфликты неизбежны, но их можно превратить в возможности:
- Для лучшего понимания
- Для поиска новых решений
- Для укрепления отношений

## Стратегии разрешения
1. **Сотрудничество** - win-win решения
2. **Компромисс** - взаимные уступки
3. **Адаптация** - уступка ради отношений
4. **Конкуренция** - отстаивание позиции
5. **Избегание** - временное отступление

## Техники деэскалации
- Активное слушание
- Признание эмоций
- Поиск общих интересов
- Фокус на проблеме, не на личности""",
                    "tasks": [
                        {
                            "title": "Анализ прошлого конфликта",
                            "description": "Вспомните недавний конфликт на работе. Проанализируйте: какая стратегия была использована? Как можно было решить его лучше? Напишите альтернативный сценарий."
                        },
                        {
                            "title": "Тренировка техники 'я-сообщений'",
                            "description": "Переформулируйте 5 обвинительных фраз в 'я-сообщения'. Например: 'Ты всегда опаздываешь' → 'Я беспокоюсь, когда встречи начинаются с опозданием'."
                        }
                    ]
                },
                {
                    "title": "Публичные выступления",
                    "description": "Преодоление страха сцены и навыки эффективной презентации",
                    "content_type": "video",
                    "duration": 30,
                    "video_url": "https://www.youtube.com/watch?v=Unzc731iCUY",
                    "video_id": "Unzc731iCUY",
                    "theory": """# Публичные выступления

## Преодоление страха
Страх публичных выступлений естественен, но преодолим:
- Подготовка снижает тревогу
- Практика повышает уверенность
- Техники релаксации помогают

## Структура презентации
1. **Введение** - захват внимания
2. **Основная часть** - 3-5 ключевых пунктов
3. **Заключение** - призыв к действию

## Техники вовлечения
- Вопросы к аудитории
- Интерактивные элементы
- Истории и примеры
- Визуальные материалы""",
                    "tasks": [
                        {
                            "title": "Мини-презентация",
                            "description": "Подготовьте и проведите 3-минутную презентацию для коллег на тему вашей экспертизы. Запишите на видео или попросите обратную связь."
                        },
                        {
                            "title": "Техника релаксации",
                            "description": "Изучите и практикуйте технику глубокого дыхания перед выступлениями. Опишите, как она влияет на ваше состояние."
                        }
                    ]
                }
            ]
        },
        2: {  # Лидерство в команде
            "skill": "leadership",
            "lessons": [
                {
                    "title": "Основы лидерства",
                    "description": "Понимание различий между менеджментом и лидерством",
                    "content_type": "video",
                    "duration": 18,
                    "video_url": "https://www.youtube.com/watch?v=fch-p_bxdhg",
                    "video_id": "fch-p_bxdhg",
                    "theory": """# Основы лидерства

## Лидер vs Менеджер
### Лидер:
- Вдохновляет на изменения
- Фокусируется на людях
- Задает направление
- Инновации и видение

### Менеджер:
- Управляет процессами
- Фокусируется на системах
- Контролирует выполнение
- Стабильность и эффективность

## Стили лидерства
1. **Авторитарный** - четкие указания
2. **Демократический** - участие команды
3. **Либеральный** - свобода действий
4. **Ситуационный** - адаптация к обстоятельствам

## Качества лидера
- Эмоциональный интеллект
- Честность и порядочность
- Видение будущего
- Способность к обучению""",
                    "tasks": [
                        {
                            "title": "Самооценка лидерских качеств",
                            "description": "Оцените себя по 10 ключевым лидерским качествам по шкале 1-10. Выберите 3 качества для развития и составьте план действий."
                        },
                        {
                            "title": "Анализ лидера-образца",
                            "description": "Выберите лидера, которым восхищаетесь. Проанализируйте его стиль лидерства и выделите 5 принципов, которые можете применить."
                        }
                    ]
                },
                {
                    "title": "Мотивация команды",
                    "description": "Техники мотивации и вовлечения сотрудников",
                    "content_type": "video",
                    "duration": 22,
                    "video_url": "https://www.youtube.com/watch?v=u6XAPnuFjJc",
                    "video_id": "u6XAPnuFjJc",
                    "theory": """# Мотивация команды

## Теории мотивации
### Пирамида Маслоу:
1. Физиологические потребности
2. Безопасность
3. Принадлежность
4. Признание
5. Самореализация

### Теория двух факторов Герцберга:
- **Гигиенические факторы**: зарплата, условия
- **Мотивирующие факторы**: признание, рост

## Инструменты мотивации
1. **Признание достижений**
2. **Развитие и обучение**
3. **Делегирование полномочий**
4. **Создание вызовов**
5. **Обратная связь**

## Индивидуальный подход
- Изучите, что мотивирует каждого
- Адаптируйте стиль под человека
- Регулярно обсуждайте цели""",
                    "tasks": [
                        {
                            "title": "Карта мотивации команды",
                            "description": "Создайте карту мотивации для каждого члена команды: что их вдохновляет, какие цели у них есть, как их лучше мотивировать."
                        },
                        {
                            "title": "Эксперимент с признанием",
                            "description": "В течение недели каждый день находите повод искренне похвалить разных членов команды. Отметьте изменения в их поведении."
                        }
                    ]
                },
                {
                    "title": "Принятие решений",
                    "description": "Методы принятия эффективных решений в команде",
                    "content_type": "video",
                    "duration": 25,
                    "video_url": "https://www.youtube.com/watch?v=nVr_BzTy_Bw",
                    "video_id": "nVr_BzTy_Bw",
                    "theory": """# Принятие решений

## Процесс принятия решений
1. **Определение проблемы**
2. **Сбор информации**
3. **Генерация альтернатив**
4. **Оценка вариантов**
5. **Выбор решения**
6. **Реализация**
7. **Оценка результатов**

## Методы принятия решений
### Индивидуальные:
- SWOT-анализ
- Матрица решений
- Дерево решений

### Групповые:
- Мозговой штурм
- Метод Дельфи
- Консенсус

## Ловушки принятия решений
- Подтверждение предубеждений
- Анализ до паралича
- Эскалация обязательств
- Групповое мышление""",
                    "tasks": [
                        {
                            "title": "SWOT-анализ решения",
                            "description": "Выберите актуальное решение и проведите SWOT-анализ: Strengths, Weaknesses, Opportunities, Threats. Используйте результаты для принятия решения."
                        },
                        {
                            "title": "Групповое принятие решения",
                            "description": "Организуйте сессию группового принятия решения по рабочему вопросу, используя метод мозгового штурма с последующим голосованием."
                        }
                    ]
                },
                {
                    "title": "Делегирование полномочий",
                    "description": "Искусство эффективного делегирования задач",
                    "content_type": "video",
                    "duration": 20,
                    "video_url": "https://www.youtube.com/watch?v=VZF5-2dOOTw",
                    "video_id": "VZF5-2dOOTw",
                    "theory": """# Делегирование полномочий

## Зачем делегировать?
- Развитие команды
- Освобождение времени лидера
- Повышение мотивации
- Масштабирование результатов

## Что делегировать?
### ДА:
- Рутинные задачи
- Задачи для развития
- Специализированную работу
- Проекты целиком

### НЕТ:
- Конфиденциальные вопросы
- Стратегические решения
- Кризисные ситуации
- Работу с проблемными сотрудниками

## Процесс делегирования
1. **Выбор задачи и исполнителя**
2. **Постановка четких целей**
3. **Определение полномочий**
4. **Контрольные точки**
5. **Поддержка и обратная связь**""",
                    "tasks": [
                        {
                            "title": "Аудит задач для делегирования",
                            "description": "Проанализируйте свои текущие задачи. Составьте список из 10 задач, которые можно делегировать, и определите подходящих исполнителей."
                        },
                        {
                            "title": "Практика делегирования",
                            "description": "Выберите одну задачу и делегируйте ее, следуя всем этапам процесса. Документируйте опыт и результаты."
                        }
                    ]
                }
            ]
        },
        3: {  # Управление временем
            "skill": "time_management",
            "lessons": [
                {
                    "title": "Основы планирования времени",
                    "description": "Принципы эффективного планирования и постановки приоритетов",
                    "content_type": "video",
                    "duration": 16,
                    "video_url": "https://www.youtube.com/watch?v=iONDebHX9qk",
                    "video_id": "iONDebHX9qk",
                    "theory": """# Основы планирования времени

## Принципы тайм-менеджмента
1. **Планирование** - основа эффективности
2. **Приоритизация** - важное vs срочное
3. **Фокус** - одна задача за раз
4. **Отдых** - восстановление энергии

## Матрица Эйзенхауэра
### Квадрант 1: Важное + Срочное
- Кризисы и чрезвычайные ситуации
- Действовать немедленно

### Квадрант 2: Важное + Несрочное
- Планирование и профилактика
- Инвестировать время

### Квадрант 3: Неважное + Срочное
- Отвлекающие звонки и письма
- Делегировать

### Квадрант 4: Неважное + Несрочное
- Пустая трата времени
- Исключать

## Техники планирования
- Правило 80/20 (Парето)
- Метод SMART для целей
- Временные блоки
- Еженедельное планирование""",
                    "tasks": [
                        {
                            "title": "Анализ использования времени",
                            "description": "В течение дня записывайте каждые 30 минут, чем занимались. Вечером проанализируйте и распределите активности по матрице Эйзенхауэра."
                        },
                        {
                            "title": "Создание еженедельного плана",
                            "description": "Составьте план на неделю, используя принципы приоритизации. Выделите время для важных несрочных задач."
                        }
                    ]
                },
                {
                    "title": "Техники концентрации",
                    "description": "Методы повышения продуктивности и борьбы с отвлечениями",
                    "content_type": "video",
                    "duration": 18,
                    "video_url": "https://www.youtube.com/watch?v=H0k0TQfZGSc",
                    "video_id": "H0k0TQfZGSc",
                    "theory": """# Техники концентрации

## Техника Помодоро
1. 25 минут сосредоточенной работы
2. 5 минут короткий перерыв
3. После 4 циклов - длинный перерыв 15-30 минут

## Принципы deep work
- Исключение отвлечений
- Глубокое погружение
- Качество > количество
- Развитие навыка концентрации

## Борьба с отвлечениями
### Внешние:
- Уведомления телефона/компьютера
- Шум в офисе
- Прерывания коллег

### Внутренние:
- Тревожные мысли
- Многозадачность
- Прокрастинация

## Создание среды для концентрации
- Организованное рабочее место
- Минимум визуальных отвлечений
- Комфортная температура
- Правильное освещение""",
                    "tasks": [
                        {
                            "title": "Эксперимент с техникой Помодоро",
                            "description": "Попробуйте технику Помодоро в течение рабочего дня. Отметьте, как изменилась ваша продуктивность и качество концентрации."
                        },
                        {
                            "title": "Аудит отвлечений",
                            "description": "Составьте список всех отвлечений в вашем рабочем дне. Разработайте стратегии для минимизации каждого из них."
                        }
                    ]
                },
                {
                    "title": "Делегирование и автоматизация",
                    "description": "Способы освобождения времени через делегирование и автоматизацию",
                    "content_type": "video",
                    "duration": 20,
                    "video_url": "https://www.youtube.com/watch?v=arj7oStGLkU",
                    "video_id": "arj7oStGLkU",
                    "theory": """# Делегирование и автоматизация

## Принцип делегирования времени
Если задачу может выполнить кто-то другой за 80% качества, лучше делегировать

## Что автоматизировать:
1. **Рутинные процессы**
   - Обработка email
   - Планирование встреч
   - Отчеты

2. **Повторяющиеся задачи**
   - Создание документов
   - Обновление данных
   - Коммуникация

## Инструменты автоматизации
- Email фильтры и шаблоны
- Календарные автоматизации
- CRM системы
- Макросы и скрипты

## Делегирование vs контроль
- Четкие инструкции
- Контрольные точки
- Обучение исполнителей
- Доверие процессу""",
                    "tasks": [
                        {
                            "title": "Карта автоматизации",
                            "description": "Создайте список из 20 рутинных задач. Для каждой определите возможность автоматизации или делегирования."
                        },
                        {
                            "title": "Внедрение одной автоматизации",
                            "description": "Выберите одну задачу и автоматизируйте ее (например, настройте фильтры email или шаблоны ответов). Измерьте экономию времени."
                        }
                    ]
                }
            ]
        }
    }
    
    # Добавляем материалы обучения и связываем с курсами
    for course_id, course_data in lessons_data.items():
        print(f"\nОбрабатываем курс ID {course_id}")
        
        for order, lesson in enumerate(course_data["lessons"], 1):
            # Добавляем материал обучения
            cursor.execute("""
                INSERT INTO learning_materials 
                (title, description, content_type, skill_type, difficulty_level, duration_minutes, 
                 theory_content, video_url, video_id, is_published, created_at, updated_at)
                VALUES (?, ?, ?, ?, 'beginner', ?, ?, ?, ?, 1, ?, ?)
            """, (
                lesson["title"],
                lesson["description"],
                lesson["content_type"],
                course_data["skill"],
                lesson["duration"],
                lesson["theory"],
                lesson["video_url"],
                lesson["video_id"],
                datetime.now().isoformat(),
                datetime.now().isoformat()
            ))
            
            material_id = cursor.lastrowid
            print(f"  Добавлен материал: {lesson['title']} (ID: {material_id})")
            
            # Связываем материал с курсом
            cursor.execute("""
                INSERT INTO course_lessons (course_id, material_id, order_position, is_required, created_at)
                VALUES (?, ?, ?, 1, ?)
            """, (course_id, material_id, order, datetime.now().isoformat()))
            
            # Добавляем задания для урока
            for task_order, task in enumerate(lesson["tasks"], 1):
                cursor.execute("""
                    INSERT INTO learning_tasks (material_id, title, description, order_position, created_at)
                    VALUES (?, ?, ?, ?, ?)
                """, (
                    material_id,
                    task["title"],
                    task["description"],
                    task_order,
                    datetime.now().isoformat()
                ))
                print(f"    Добавлено задание: {task['title']}")
    
    conn.commit()
    
    # Проверяем результат
    cursor.execute("""
        SELECT c.title, COUNT(cl.id) as lessons_count
        FROM courses c
        LEFT JOIN course_lessons cl ON c.id = cl.course_id
        GROUP BY c.id, c.title
    """)
    
    results = cursor.fetchall()
    print("\n=== Итоговый результат ===")
    for course_title, lessons_count in results:
        print(f"{course_title}: {lessons_count} уроков")
    
    conn.close()
    print("\nДанные успешно добавлены!")

if __name__ == "__main__":
    add_lessons_to_courses() 